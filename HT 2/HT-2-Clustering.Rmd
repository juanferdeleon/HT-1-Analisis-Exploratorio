---
title: "HT-1-Analisis-Exploratorio"
author: "Juan De Leon, Maria Jose Castro, Jose Block"
date: "02/22/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Hoja de Trabajo 2
### Clustering


1. Haga el preprocesamiento del dataset, explique qué variables no aportan información a la generación de grupos y por qué. Describa con qué variables calculará los grupos.


```{r echo=FALSE}
variables <- matrix(c('Id', 'imdb_id', 'original_title', 'homepage', 'tagline', 'overview'), ncol=1, byrow=TRUE)
colnames(variables) <- c("Variables que no aportan inforacion para el clustering")
rownames(variables) <- c(1, 2, 3, 4, 5, 6)
variables <- as.table(variables)
variables
```

Se consideró que las variables mencionadas anteriormente no aportan ningun valor significatico en la formacion de grupos ya que estas son caracteristicas unicas de cada registro dentro del data set. 

```{r}

dataframe = read.csv("../Data/tmdb-movies.csv")
dataframe <- na.omit(dataframe)

dataframe$popularity = ifelse(is.na(dataframe$popularity),ave(dataframe$popularity, FUN = function(x) mean(x, na.rm = 'TRUE')),dataframe$popularity)
dataframe$budget = ifelse(is.na(dataframe$budget),ave(dataframe$budget, FUN = function(x) mean(x, na.rm = 'TRUE')),dataframe$budget)
dataframe$revenue = ifelse(is.na(dataframe$revenue),ave(dataframe$revenue, FUN = function(x) mean(x, na.rm = 'TRUE')),dataframe$revenue)
dataframe$runtime = ifelse(is.na(dataframe$runtime),ave(dataframe$runtime, FUN = function(x) mean(x, na.rm = 'TRUE')),dataframe$runtime)
dataframe$vote_count = ifelse(is.na(dataframe$vote_count),ave(dataframe$vote_count, FUN = function(x) mean(x, na.rm = 'TRUE')),dataframe$vote_count)
dataframe$vote_average = ifelse(is.na(dataframe$vote_average),ave(dataframe$vote_average, FUN = function(x) mean(x, na.rm = 'TRUE')),dataframe$vote_average)

```

Se realizo una verificacion de las variables cuantitativas para remover los valores N/A.


2. Determine cuál es el número de grupos a formar más adecuado para los datos que está trabajando. Haga una gráfica de codo y explique la razón de la elección de la cantidad de clústeres con la que trabajará.

```{r echo=FALSE, include=FALSE, warning=FALSE}

set.seed(20)
data.matrix(dataframe)
test1 <- scale(na.omit(data.matrix(dataframe)[-1]))

wssplot <- function(test1, nc=20, seed=123){
  wss <- (nrow(test1)-1)*sum(apply(test1, 2, var))
  for (i in 2:nc){
    set.seed(seed)
    wss[i] <- sum(kmeans(test1, centers = i)$withinss)
  }
  plot(1:nc, wss, type="b", xlab="Number of clusters", ylab="Whithin Groups Sum of squares")
}
```

```{r echo=FALSE, warning=FALSE}

wssplot(test1, nc=20)


```


Para seleccionar el valor óptimo de k, se escoje entonces ese punto en donde ya no se dejan de producir variaciones importantes del valor de WCSS al aumentar k. En este caso, vemos que esto se produce a partir de k >= 5, por lo que evaluaremos los resultados del agrupamiento, por ejemplo, con los valores de 7, 8 y 9 a fin de observar el comportamiento del modelo.


3. Utilice 3 algoritmos existentes para agrupamiento. Compare los resultados generados por cada uno.

## Hierarchical Clustering

```{r echo=FALSE, warning=FALSE}

dft <- data.frame(dataframe$budget, dataframe$revenue)

library(ggdendro)
library(ggplot2)

seeds_df_sc <- as.data.frame(scale(dft))

dist_mat <- dist(seeds_df_sc, method = 'euclidean')

hclust_avg <- hclust(dist_mat, method = 'average')

plot(hclust_avg)

agrupamientoJ <- hclust(dist(dataframe, method = 'euclidean'), method = 'ward.D')
clases_aj <- cutree(agrupamientoJ, k = 5)
dataframe$cluster <- clases_aj

ggplot() + geom_point(aes(x = budget, y = revenue, color = cluster), data = dataframe, size = 2) +
  scale_colour_gradientn(colours=rainbow(4)) +
  ggtitle('Clusters de Datos con k = 5 / Agrupamiento Jerárquico') + 
  xlab('X') + ylab('Y')


```


4. Determine la calidad del agrupamiento hecho por cada algoritmo con el método de la silueta. Discuta los resultados.

```{r echo=FALSE, warning=FALSE}

library(cluster)    # clustering algorithms

avg_sil <- function(k) {
  km.res <- kmeans(na.omit(dft), centers = k, nstart = 25)
  ss <- silhouette(km.res$cluster, dist(dft))
  mean(ss[, 3])
}

k.values <- 2:14

avg_sil_values <- sapply(k.values, avg_sil)

plot(k.values, avg_sil_values,
       type = "b", pch = 19, frame = FALSE, 
       xlab = "Number of clusters K",
       ylab = "Average Silhouettes")

```

5. Interprete los grupos basado en el conocimiento que tiene de los datos. Recuerde investigar las medidas de tendencia central de las variables continuas y las tablas de frecuencia de las variables categóricas pertenecientes a cada grupo. Identifique hallazgos interesantes debido a las agrupaciones y describa para qué le podría servir.